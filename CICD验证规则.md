### ðŸ›¡ï¸ é›…å…¸å¨œè®¡åˆ’ï¼šCI/CD ä¿®å¤äº”å¤§å®ªç« ä»¥åŠæœ€æ–°çš„é”™è¯¯æç¤ºï¼š

é¡¹ç›®ä»“åº“åœ°å€ï¼šhttps://github.com/DANIELZHANG11/Athena.git

#### 1. â€œæž¶æž„é™çº§â€é›¶å®¹å¿åŽŸåˆ™ (No Architectural Regression)
*   **åœºæ™¯**ï¼šå¦‚æžœè®¡è´¹æµ‹è¯•æŒ‚äº†ï¼ŒæŠ¥é”™è¯´â€œæ•°æ®åº“é”è¶…æ—¶â€æˆ–â€œäº‹åŠ¡å›žæ»šâ€ã€‚
*   **åŽŸåˆ™**ï¼š**ç»å¯¹ä¸å…è®¸**ä¸ºäº†è®©æµ‹è¯•é€šè¿‡ï¼Œè€Œç§»é™¤ `FOR UPDATE` é”æˆ– `atomic update`ï¼ˆåŽŸå­æ›´æ–°ï¼‰é€»è¾‘ã€‚**ç»å¯¹ä¸å…è®¸**æŠŠæ•°æ®åº“äº‹åŠ¡æ‹†æ•£ã€‚
*   **æŒ‡ä»¤è¯æœ¯**ï¼š*â€œä¿®å¤è¿™ä¸ªæµ‹è¯•é”™è¯¯ï¼Œä½†**ä¸¥ç¦**ä¿®æ”¹è®¡è´¹çš„åŽŸå­æ€§é€»è¾‘ã€‚å¦‚æžœæ˜¯æµ‹è¯•ç”¨ä¾‹å†™å¾—ä¸å¯¹ï¼ˆæ¯”å¦‚æ²¡æ¨¡æ‹Ÿå¥½å¹¶å‘çŽ¯å¢ƒï¼‰ï¼Œè¯·ä¿®æ”¹æµ‹è¯•ç”¨ä¾‹ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ä¸šåŠ¡ä»£ç ã€‚â€*

#### 2. DDL éš”ç¦»åŽŸåˆ™ (Migration Sanctity)
*   **åœºæ™¯**ï¼šå¦‚æžœæµ‹è¯•æŠ¥é”™è¯´ `Table 'users' already exists` æˆ– `Relation not found`ã€‚
*   **åŽŸåˆ™**ï¼š**ä¸¥ç¦**åœ¨ä»£ç é‡ŒåŠ å›ž `CREATE TABLE IF NOT EXISTS`ã€‚
*   **åŽŸå› **ï¼šè¿™æ˜¯æˆ‘ä»¬åˆšåˆšè´¹åŠ²æ¸…ç†æŽ‰çš„â€œæ¯’ç˜¤â€ã€‚
*   **æŒ‡ä»¤è¯æœ¯**ï¼š*â€œæ£€æŸ¥ Alembic è¿ç§»è„šæœ¬æ˜¯å¦åœ¨ CI çŽ¯å¢ƒä¸­æ­£ç¡®æ‰§è¡Œäº†ã€‚å¦‚æžœæ˜¯è¡¨ç»“æž„ç¼ºå¤±ï¼Œè¯·æ–°å¢ž Alembic ç‰ˆæœ¬æ–‡ä»¶ï¼Œ**ç»ä¸è®¸**åœ¨ä¸šåŠ¡ä»£ç é‡Œå†™ SQL å»ºè¡¨è¯­å¥ã€‚â€*

#### 3. çœŸå®žæœåŠ¡ vs æµ‹è¯• Mock çš„è¾¹ç•ŒåŽŸåˆ™
*   **åœºæ™¯**ï¼šçŽ°åœ¨ä»£ç é‡Œé›†æˆäº† `PaddleOCR` å’Œ `BGE-M3`ï¼Œè¿™äº›åº“å¾ˆå¤§ï¼ŒCI çŽ¯å¢ƒï¼ˆGitHub Actionsï¼‰å¯èƒ½è·‘ä¸åŠ¨æˆ–è€…æ²¡æ˜¾å¡ï¼Œå¯¼è‡´å®‰è£…è¶…æ—¶æˆ–å†…å­˜æº¢å‡ºæŠ¥é”™ã€‚
*   **åŽŸåˆ™**ï¼š**CI çŽ¯å¢ƒä¸­å…è®¸ä½¿ç”¨ Mockï¼Œä½†ç”Ÿäº§çŽ¯å¢ƒå¿…é¡»ç”¨çœŸå®¶ä¼™ã€‚**
*   **æŒ‡ä»¤è¯æœ¯**ï¼š*â€œCI çŽ¯å¢ƒèµ„æºæœ‰é™ã€‚è¯·ç¡®ä¿ `conftest.py` æˆ–æµ‹è¯•é…ç½®ä¸­ï¼Œèƒ½å¤Ÿæ£€æµ‹ `TESTING` çŽ¯å¢ƒå˜é‡ã€‚åœ¨æµ‹è¯•è¿è¡Œæ—¶ï¼Œè‡ªåŠ¨æ³¨å…¥ `MockOCR` å’Œ `MockEmbedder` æ¥æ›¿ä»£çœŸå®žçš„ `PaddleOCR`ï¼Œä½†åœ¨ Docker ç”Ÿäº§é•œåƒæž„å»ºæ—¶ï¼Œå¿…é¡»ä¿ç•™çœŸå®žåº“çš„ä¾èµ–ã€‚â€*

#### 4. ä¾èµ–é”å®šåŽŸåˆ™ (Dependency Strictness)
*   **åœºæ™¯**ï¼šæŠ¥é”™ `ModuleNotFoundError` æˆ– `VersionConflict`ã€‚
*   **åŽŸåˆ™**ï¼šä¸è¦éšæ„å‡çº§æˆ–é™çº§æ ¸å¿ƒåº“ï¼ˆå°¤å…¶æ˜¯ `fastapi`, `sqlalchemy`, `pydantic`ï¼‰ã€‚
*   **æŒ‡ä»¤è¯æœ¯**ï¼š*â€œè¯·åˆ†æžä¾èµ–å†²çªçš„åŽŸå› ã€‚å¦‚æžœéœ€è¦æ·»åŠ æ–°åº“ï¼ˆå¦‚ `paddleocr`ï¼‰ï¼Œè¯·ç¡®ä¿å®ƒä¸ŽçŽ°æœ‰çš„ `python 3.11` çŽ¯å¢ƒå…¼å®¹ï¼Œå¹¶å°†ç²¾ç¡®ç‰ˆæœ¬å·å†™å…¥ `requirements.txt`ã€‚â€*

#### 5. åŸºç¡€è®¾æ–½å¯¹é½åŽŸåˆ™ (Infra Alignment)
*   **åœºæ™¯**ï¼šæµ‹è¯•æŠ¥é”™ `Connection Refused` è¿žæŽ¥ä¸ä¸Š `s3://...` æˆ– `opensearch`ã€‚
*   **åŽŸåˆ™**ï¼šä»£ç å·²ç»æ”¹æˆäº† SeaweedFS å’Œ OpenSearchï¼Œä½† CI çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚ `.github/workflows/main.yml` æˆ– `tests/docker-compose.test.yml`ï¼‰å¯èƒ½è¿˜æ²¡æ”¹ï¼Œè¿˜åœ¨ç”¨ MinIO/ESã€‚
*   **æŒ‡ä»¤è¯æœ¯**ï¼š*â€œä¸è¦ä¿®æ”¹åŽç«¯è¿žæŽ¥ä»£ç ã€‚è¯·æ£€æŸ¥ CI çš„é…ç½®æ–‡ä»¶å’ŒæœåŠ¡å®šä¹‰ï¼Œç¡®ä¿æµ‹è¯•çŽ¯å¢ƒå¯åŠ¨çš„æ˜¯ `seaweedfs` å’Œ `opensearch`ï¼Œä¸”ç«¯å£æ˜ å°„ä¸ŽåŽç«¯ä»£ç ä¸­çš„é…ç½®ä¸€è‡´ã€‚â€*

---

### ðŸš‘ é’ˆå¯¹å¸¸è§æŠ¥é”™çš„â€œæ€¥æ•‘åŒ…â€ (Cheat Sheet)

å½“çœ‹åˆ°ä»¥ä¸‹é”™è¯¯æ—¶ï¼Œç›´æŽ¥å¤åˆ¶å¯¹åº”çš„æŒ‡ä»¤ç»™ AIï¼š

**æƒ…å†µ Aï¼šLint/Format é”™è¯¯ (Flake8, Black, Isort)**
> **æŒ‡ä»¤**ï¼š*â€œè¿™æ˜¯ä»£ç é£Žæ ¼é—®é¢˜ã€‚è¯·ç›´æŽ¥è¿è¡Œæ ¼å¼åŒ–å·¥å…·ä¿®å¤æ‰€æœ‰ lint é”™è¯¯ï¼Œä¸è¦ä¿®æ”¹ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚â€*

**æƒ…å†µ Bï¼šMypy ç±»åž‹æ£€æŸ¥é”™è¯¯ (Type Mismatch)**
> **æŒ‡ä»¤**ï¼š*â€œè¯·ä¿®å¤ç±»åž‹æ³¨è§£é”™è¯¯ã€‚å¦‚æžœæ˜¯ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ paddleocrï¼‰ç¼ºå°‘ç±»åž‹å®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨ `# type: ignore` ä¸´æ—¶è§„é¿ï¼Œä½†ä¸è¦ä¿®æ”¹å˜é‡çš„å®žé™…ç±»åž‹ã€‚â€*

**æƒ…å†µ Cï¼šDocker æž„å»ºå¤±è´¥ (Build Failure)**
> **æŒ‡ä»¤**ï¼š*â€œDocker æž„å»ºå¤±è´¥ã€‚è¯·æ£€æŸ¥ `Dockerfile`ã€‚å¦‚æžœæ˜¯ PaddleOCR æˆ– PyTorch å¯¼è‡´é•œåƒè¿‡å¤§æˆ–ä¸‹è½½è¶…æ—¶ï¼Œè¯·å°è¯•ä½¿ç”¨å›½å†…é•œåƒæºæˆ–ç²¾ç®€ç‰ˆåŸºç¡€é•œåƒï¼Œå¹¶ç¡®ä¿ä½¿ç”¨å¤šé˜¶æ®µæž„å»ºï¼ˆMulti-stage buildï¼‰å‡å°ä½“ç§¯ã€‚â€*

**æƒ…å†µ Dï¼šæ•°æ®åº“è¿ç§»å¤±è´¥ (Alembic Divergence)**
> **æŒ‡ä»¤**ï¼š*â€œæ•°æ®åº“æ¨¡åž‹ä¸Žè¿ç§»è„šæœ¬ä¸ä¸€è‡´ã€‚è¯·ä¸è¦ä¿®æ”¹æ¨¡åž‹ã€‚è¯·ç”Ÿæˆä¸€ä¸ªæ–°çš„ `alembic revision --autogenerate` è„šæœ¬æ¥å¯¹é½æ•°æ®åº“çŠ¶æ€ã€‚â€*

---
ä¿®å¤ï¼Œè°ƒæ•´æˆ–è¡¥å…¨ä»£ç åŽï¼Œé‡æ–°æŽ¨é€è‡³GITHUBä»“åº“è¿›è¡ŒéªŒè¯


Run pnpm run typecheck

> athena-web@0.0.1 typecheck /home/runner/work/Athena/Athena/web
> tsc --noEmit

Error: src/layouts/LandingLayout.tsx(3,18): error TS2307: Cannot find module '../../i18n' or its corresponding type declarations.
â€‰ELIFECYCLEâ€‰ Command failed with exit code 2.
Error: Process completed with exit code 2.
## 技术文档修订

* 术语统一：对象存储改为“SeaweedFS（S3 兼容）”，保留 `MINIO_*` 环境变量前缀的兼容说明与公共域名重写；在上传/下载章节加入预签名与 ETag 去重的现状。

* 数据库 Schema：

  1. 新增 `books.meta JSONB`（含 `page_count`）与索引；解释占位与后台回填流程。
  2. `conversion_jobs` 统一列名为 `user_id`（与 0100 迁移一致）。
  3. 新建 `notes/tags/highlights` 与 `note_tags/highlight_tags` 表；索引（`user_updated`、`GIN(tsv)`）、外键 `ON DELETE CASCADE`、RLS 策略（用户自有与 `app.role='admin'` 绕过）。
  4. `tags` 唯一约束调整为部分唯一索引：`UNIQUE(user_id,name) WHERE deleted_at IS NULL`。
  5. `pricing_rules` 增加 `platform/sku_id` 字段说明与用途（多平台差异化定价）。

* 业务流程：

  * 上传完成：写入占位 `meta.page_count=1` 与 `needs_manual=true`；深度分析补填缺失的页数占位。

  * OCR 阶梯：以 `meta.page_count` 为依据，详细阈值与策略（free/addon），并发与优先级说明。

* 开发与预览：Vite `VITE_API_BASE_URL` 代理与 `hmr.ws`；桌面 Tauri `devPath/CSP` 示例；`.env` 样例。

* PWA 离线：缓存键 `book-${bookId}-${etag}`、派生资产前缀、LRU 清理、离线管理页；IndexedDB 队列、乐观并发与冲突生成 `note_versions`。

* CI 门禁：axe 严重/高违规=0 与核心旅程 E2E 固化为门槛；测试环境服务为 SeaweedFS/OpenSearch。

* 迁移记录：新增 0106/0107 迁移摘要与回滚说明；与现有 0100/0101/0104/0105 对齐。

## 设计标准修订

* 系统色 Token 明确：在 `:root` 与 `.dark` 定义 `--color-system-blue/--color-label/--color-secondary-label/--color-system-fill` 的真实值；说明组件引用规则与 FIGMA Token映射。

* 按钮组件规范：禁止页面内联样式；`primary` 变体圆角 999、字重 600；颜色依赖系统 Token；A11Y 聚焦环与键盘操作要求。

* 首页基线：CTA 使用统一 `Button`；移除内联样式；保留现有字号/动效规格与 Parallax/Marquee 的实现参数对齐。

* Tailwind v4 用法：重申 `@import "tailwindcss" + @theme inline + @layer base`，Token 定义集中在 `web/src/styles/figma.css`。

* 可访问性：对比度、焦点顺序、`prefers-reduced-motion` 降级与 axe 检查列为必查项。

## 交付与校验

* 同步更新两份文档对应章节与示例代码片段；在文档中添加“交叉验证清单”。

* 验收：

  * 设计：Button/NavItem 在明暗模式颜色正确，axe 通过。

  * 技术：DB 结构与接口一致；`pricing` 返回含 `platform/sku_id`，`conversion_jobs` 以 `user_id` 查询。

  * PWA：断网可读缓存、重连自动同步并生成版本冲突记录。


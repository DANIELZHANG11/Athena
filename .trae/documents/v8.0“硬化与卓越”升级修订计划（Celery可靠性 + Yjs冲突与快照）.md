## 目标
- 在 v7.1 基础上完成两项专家级强化：
  1) Celery + Redis Streams 的可靠性配置与幂等保障
  2) Yjs 实时协同的冲突处理与版本快照策略
- 升级文档版本至 v8.0，并更新变更日志与最终声明。

## 变更位置
- 在“第五章：AI协作与开发流程”（行约 243）新增小节：**Celery Broker 可靠性配置（新增）**
- 在“6.12 WebSocket 标准与 Yjs 协同”（行约 464）新增小节：**Yjs 冲突解决与版本快照（新增）**
- 在结尾“变更日志”新增 **v8.0** 条目与封版声明。

## Celery 可靠性配置（新增内容）
- 问题陈述：Redis Broker 抖动/重启导致消费者冻结的风险说明。
- 配置示例（生产）：
  - `broker_heartbeat: 30`
  - `broker_connection_retry_on_startup: true`
  - `task_acks_late: true`
  - `task_reject_on_worker_lost: true`
- 幂等性再强调：所有任务必须从业务层支持幂等（idempotency_key 检查），避免重复执行导致副作用。

## Yjs 冲突与快照（新增内容）
- 版本控制：`note_versions.version_number` 单调递增（明确约束）。
- 快照策略：每累计 100 次 Yjs Update 或距上次保存超过 5 分钟生成新的快照。
- 服务端冲突检测伪代码：比较客户端 `client_version` 与服务端最新 `server_version`，冲突时返回 `conflict` 消息（包含 `version_number` 与 `state_vector`），不应用更新。
- 前端冲突恢复：IndexedDB 草稿保存 → 后台使用 `state_vector` 同步 → 自动应用草稿 → Toast 非阻塞提示（禁用模态弹窗）。

## 验证
- 新增小节与既有章节一致，无冲突；用词与格式统一。
- 变更日志包含 v8.0 条目，声明封版就绪。

准备就绪后，我将按上述方案直接插入与对齐相关章节并更新变更日志为 v8.0。
## 目标
- 1.2：初始化 PostgreSQL+pgvector、Alembic 迁移、RLS 模板、会话变量中间件（SET LOCAL app.user_id/app.role）。
- 1.3：初始化前端 React+Vite+TS+Zustand+TanStack Query，接入 i18n 与 Lucide 图标，PWA 与基本 ESLint 门禁（no-hardcode 脚本）。

## 主要改动与文件
- docker-compose：将 postgres 改为 pgvector 镜像（ankane/pgvector），加健康检查。
- API 后端：
  - `api/app/db.py`：SQLAlchemy AsyncEngine/Session 工厂，连接事件或请求依赖中执行 `SET LOCAL app.user_id/app.role`。
  - `api/alembic.ini`、`api/alembic/`：Alembic 基础配置与迁移脚本。
  - `api/alembic/versions/xxxxxxxx_init.py`：
    - `CREATE EXTENSION IF NOT EXISTS vector`。
    - 创建核心表：`languages`、`translations`（UNIQUE(lang_code,key)；索引 lang_code/key；RLS 管理员策略）。
    - 创建并启用 RLS 的 5 表：`user_sessions`、`reading_progress`（索引 (user_id, book_id, updated_at DESC)）、`dict_history`、`payment_gateways`、`dictionary_packages`（管理员策略+is_active 索引）。
- Web 前端：
  - `web/package.json`：scripts：`dev`、`build`、`lint`、`typecheck`、`i18n:sync`、`i18n:no-hardcode`。
  - `web/tsconfig.json`、`web/vite.config.ts`、`web/src/main.tsx`、`web/src/App.tsx`、`web/src/i18n.ts`、`web/src/locales/`（占位 JSON）。
  - `web/.eslintrc.cjs`、`web/.prettierrc`、`web/scripts/no-hardcode.js`（扫描 src 下硬编码中文/英文字符串）。
  - Lucide 示例：在 `App.tsx` 使用 `lucide-react` 图标与 tokens 颜色。
  - PWA：注册 `sw.js` 与基础缓存（或占位，后续可切 Vite PWA 插件）。

## 验证
- 后端：
  - 运行 Alembic `upgrade head`，验证扩展与表/索引/RLS 策略建立成功。
  - 通过后端依赖在请求中执行 `SET LOCAL`；手工查询验证 RLS 生效（非所有者拒绝）。
  - `GET /health` 正常。
- 前端：
  - `pnpm install` 后 `pnpm dev` 启动，页面加载成功，Lucide 图标显示。
  - 运行 `pnpm i18n:no-hardcode`，对示例代码通过；后续接入 SyncLocales。

## 文档回写（行号）
- 记录 RLS 与索引的行号引用；标注 i18n/no-hardcode 与前端骨架位置，符合 1.2/1.3 的“文档回写”要求。

## 回滚
- Alembic 可 `downgrade`。
- 前端变更可直接删除 `web/` 或回退提交。

## 备注
- 若本地镜像拉取需用私有域，Compose 已支持 `${REGISTRY}` 前缀，无需额外改动。